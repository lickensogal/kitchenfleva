<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Fleva Sidebar Component</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- The Sidebar Component (Hidden by default, fixed position) -->
    <div id="kitchenFlevaSidebar" class="h-full fixed top-0 left-0 w-64 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
        
        <!-- Sidebar Header / Logo -->
        <div class="p-6 border-b border-gray-100">
            <a href="/" class="text-3xl font-extrabold text-amber-600 tracking-tight">
                Kitchen <span class="text-gray-900">Fleva</span>
            </a>
        </div>

        <!-- User Info / Auth Status -->
        <div class="p-6 border-b border-gray-100">
            <div id="logged-out-section">
                <p class="text-sm font-medium text-gray-500 mb-2">Welcome to Kitchen Fleva!</p>
                <a href="/pages/login.html" class="block w-full text-center py-2 px-4 mb-2 text-sm font-semibold rounded-lg bg-amber-600 text-white shadow-md hover:bg-amber-700 transition">Log In</a>
                <a href="/pages/register.html" class="block w-full text-center py-2 px-4 text-sm font-semibold rounded-lg text-amber-600 border border-amber-600 hover:bg-amber-50 transition">Register</a>
            </div>

            <div id="logged-in-section" class="hidden">
                <p class="text-lg font-semibold text-gray-900 truncate mb-1" id="user-display-name">Hello, User!</p>
                <p class="text-xs text-gray-500 mb-3">ID: <span id="user-display-id" class="font-mono text-xs">Loading...</span></p>
                <button id="sidebar-logout-button" class="block w-full text-center py-2 px-4 text-sm font-semibold rounded-lg text-white bg-red-500 shadow-md hover:bg-red-600 transition">Sign Out</button>
            </div>
        </div>

        <!-- Navigation Links -->
        <nav class="p-4 space-y-2">
            <a href="/index.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10l-2-2m2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span class="font-medium">Home</span>
            </a>
            <a href="/recipes.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zM12 15h.01M12 21h.01M12 3h.01M17.657 16.657L18 17m-6 0a5 5 0 100-10 5 5 0 000 10zM6.343 16.657L6 17m11.314-11.314L18 7M6.686 6.686L6 7"></path></svg>
                <span class="font-medium">All Recipes</span>
            </a>
            <a href="/blog.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v3m-2 2l4 4m0 0l-4 4m4-4H7"></path></svg>
                <span class="font-medium">Cooking Blog</span>
            </a>
            <a href="/submit.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                <span class="font-medium">Submit Recipe</span>
            </a>

            <!-- User-specific links (e.g., Dashboard) -->
            <a id="dashboard-link" href="/dashboard.html" class="hidden items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6"></path></svg>
                <span class="font-medium">My Dashboard</span>
            </a>
        </nav>
        
    </div>

    <!-- Example usage / placeholder for demonstration -->
    <div class="p-10">
        <button onclick="toggleSidebar()" class="bg-amber-500 text-white p-3 rounded-lg shadow-md hover:bg-amber-600 transition">
            Toggle Sidebar
        </button>
    </div>


    <!-- Firebase and Dynamic Logic for Auth State -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // --- MANDATORY GLOBAL VARIABLE SETUP ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let auth;
        let authReady = false;

        // DOM elements
        const sidebar = document.getElementById('kitchenFlevaSidebar');
        const loggedOutSection = document.getElementById('logged-out-section');
        const loggedInSection = document.getElementById('logged-in-section');
        const sidebarLogoutButton = document.getElementById('sidebar-logout-button');
        const dashboardLink = document.getElementById('dashboard-link');
        const userDisplayName = document.getElementById('user-display-name');
        const userDisplayId = document.getElementById('user-display-id');

        // Initialize Firebase
        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
        } else {
            console.error("Firebase configuration is missing. Authentication features will be simulated.");
        }

        // Global function to show/hide the sidebar (can be called from navbar)
        window.toggleSidebar = function() {
            sidebar.classList.toggle('-translate-x-full');
        };

        // Function to update the UI based on auth state
        function updateAuthStateUI(user) {
            if (user && user.uid && !user.isAnonymous) {
                // User is signed in and authenticated (not anonymous)
                loggedOutSection.classList.add('hidden');
                loggedInSection.classList.remove('hidden');
                dashboardLink.classList.replace('hidden', 'flex'); // Show dashboard link

                userDisplayName.textContent = `Hello, Kitchen Friend!`; // Placeholder name
                userDisplayId.textContent = user.uid;
                
            } else {
                // User is signed out or anonymous
                loggedOutSection.classList.remove('hidden');
                loggedInSection.classList.add('hidden');
                dashboardLink.classList.replace('flex', 'hidden'); // Hide dashboard link
            }
        }
        
        // Handle initial authentication
        async function handleAuthInitialization() {
            if (auth) {
                // 1. Attempt to sign in with custom token if available
                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } catch (error) {
                        console.error("Error signing in with custom token, falling back to anonymous:", error.message);
                        await signInAnonymously(auth); // Fallback
                    }
                } else {
                    // 2. Sign in anonymously if no custom token is provided
                    await signInAnonymously(auth);
                }

                // 3. Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    authReady = true;
                    updateAuthStateUI(user);
                });
            } else {
                // Simulation: Assume logged out if Firebase isn't initialized
                updateAuthStateUI(null);
            }
        }

        // Add Logout Handler
        if (sidebarLogoutButton) {
            sidebarLogoutButton.addEventListener('click', async () => {
                if (auth && authReady) {
                    try {
                        await signOut(auth);
                        // UI update happens via onAuthStateChanged listener
                    } catch (error) {
                        console.error("Error signing out:", error.message);
                    }
                } else {
                    console.log("Logout simulation (Firebase not initialized or auth not ready).");
                    updateAuthStateUI(null); // Simulate logout
                }
            });
        }

        handleAuthInitialization();
    </script>
</body>
    </html>
