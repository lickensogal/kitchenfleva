<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Fleva Sidebar Component</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Ensures the whole sidebar scrolls if content overflows */
        #kitchenFlevaSidebar {
            overflow-y: auto;
        }
        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .collapse-content.open {
            max-height: 500px; /* Adjust based on max content size */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- The Sidebar Component (Hidden by default, fixed position) -->
    <div id="kitchenFlevaSidebar" class="h-full fixed top-0 left-0 w-64 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
        
        <!-- Sidebar Header / Logo -->
        <div class="p-6 border-b border-gray-100 flex justify-between items-center">
            <a href="/" class="text-3xl font-extrabold text-amber-600 tracking-tight">
                Kitchen <span class="text-gray-900">Fleva</span>
            </a>
            <!-- Close Button (Calls window.toggleSidebar() which is defined globally) -->
             <button onclick="window.toggleSidebar()" class="text-gray-400 hover:text-gray-600 transition" aria-label="Close sidebar">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <!-- User Info / Auth Status (Simplified from index.html) -->
        <div class="p-6 border-b border-gray-100">
            <div id="logged-out-section">
                <a id="sidebar-login-link" href="/pages/login.html" class="block w-full text-center py-2 px-4 text-sm font-semibold rounded-lg bg-amber-600 text-white shadow-md hover:bg-amber-700 transition">Login / Signup</a>
            </div>

            <div id="logged-in-section" class="hidden space-y-2">
                <p class="text-lg font-semibold text-gray-900 truncate" id="user-display-name">Hello, Kitchen Friend!</p>
                <p class="text-xs text-gray-500 mb-3">ID: <span id="user-display-id" class="font-mono text-xs">Loading...</span></p>
                
                <a id="sidebar-profile-link" href="/profile/dashboard.html" class="block w-full text-center py-2 px-4 text-sm font-semibold rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition">My Dashboard</a>
                <button id="sidebar-logout-button" class="block w-full text-center py-2 px-4 text-sm font-semibold rounded-lg text-white bg-red-500 shadow-md hover:bg-red-600 transition">Sign Out</button>
            </div>
        </div>

        <!-- Navigation Links (Collapsible) -->
        <nav class="p-4 space-y-1">
            <a href="/index.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                Home
            </a>
            <a href="about.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                About Us
            </a>
            
            <!-- Collapsible Menu Item: Recipes -->
            <div class="border-t border-gray-100 pt-2">
                <button onclick="toggleCollapse('recipes-menu')" class="flex justify-between items-center w-full p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                    <span>Recipes</span>
                    <svg id="recipes-menu-icon" class="w-4 h-4 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="recipes-menu" class="collapse-content ml-4 space-y-1 pb-1">
                    <a href="recipes.html" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Recipe Library</a>
                    <a href="recipes.html?category=breakfast" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Breakfast</a>
                    <a href="recipes.html?category=lunch" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Lunch</a>
                    <a href="recipes.html?category=dinner" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Dinner</a>
                </div>
            </div>

            <!-- Collapsible Menu Item: Blog -->
            <div class="border-t border-gray-100 pt-2">
                 <button onclick="toggleCollapse('blog-menu')" class="flex justify-between items-center w-full p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                    <span>Blog</span>
                    <svg id="blog-menu-icon" class="w-4 h-4 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="blog-menu" class="collapse-content ml-4 space-y-1 pb-1">
                    <a href="blog.html" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Latest Posts</a>
                    <a href="blog.html?category=tips" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Recipe Tips</a>
                    <a href="blog.html?category=ai" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">AI Cooking Insights</a>
                </div>
            </div>
            
            <!-- Collapsible Menu Item: AI Tools -->
            <div class="border-t border-gray-100 pt-2">
                <button onclick="toggleCollapse('ai-tools-menu')" class="flex justify-between items-center w-full p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                    <span>AI Tools</span>
                    <svg id="ai-tools-menu-icon" class="w-4 h-4 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="ai-tools-menu" class="collapse-content ml-4 space-y-1 pb-1">
                    <a href="ai/generator.html" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Recipe Generator</a>
                    <a href="ai/mealplan.html" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Meal Plan Generator</a>
                    <a href="ai/video.html" class="block p-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">Video Generator</a>
                </div>
            </div>

            <a href="membership.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                Membership
            </a>
             <a href="shop.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-amber-50 hover:text-amber-700 transition font-semibold">
                Shop / Digital Products
            </a>
        </nav>
        
    </div>

    <!-- Firebase and Dynamic Logic for Auth State and Collapse -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // --- MANDATORY GLOBAL VARIABLE SETUP ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let auth;
        let authReady = false;

        // DOM elements
        const sidebar = document.getElementById('kitchenFlevaSidebar');
        const loggedOutSection = document.getElementById('logged-out-section');
        const loggedInSection = document.getElementById('logged-in-section');
        const sidebarLogoutButton = document.getElementById('sidebar-logout-button');
        const sidebarLoginLink = document.getElementById('sidebar-login-link');
        const sidebarProfileLink = document.getElementById('sidebar-profile-link');
        const userDisplayId = document.getElementById('user-display-id');

        // Initialize Firebase
        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
        } else {
            console.error("Firebase configuration is missing. Authentication features will be simulated.");
        }

        // --- Sidebar Visibility Toggle ---
        // This function must be globally available for the Navbar to call it.
        window.toggleSidebar = function() {
            sidebar.classList.toggle('-translate-x-full');
        };

        // --- Collapsible Menu Logic ---
        window.toggleCollapse = function(id) {
            const menu = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');

            if (menu.classList.contains('open')) {
                // Collapse it
                menu.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
            } else {
                // Expand it
                menu.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
            }
        };


        // --- Auth State Logic ---
        function updateAuthStateUI(user) {
            const isLoggedIn = user && user.uid && !user.isAnonymous;

            if (isLoggedIn) {
                loggedOutSection.classList.add('hidden');
                loggedInSection.classList.remove('hidden');
                sidebarLoginLink.classList.add('hidden');
                sidebarProfileLink.classList.remove('hidden');
                sidebarLogoutButton.classList.remove('hidden');
                userDisplayId.textContent = user.uid;
            } else {
                loggedOutSection.classList.remove('hidden');
                loggedInSection.classList.add('hidden');
                sidebarLoginLink.classList.remove('hidden');
                sidebarProfileLink.classList.add('hidden');
                sidebarLogoutButton.classList.add('hidden');
            }
        }
        
        // Handle initial authentication
        async function handleAuthInitialization() {
            if (auth) {
                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } catch (error) {
                        console.error("Error signing in with custom token, falling back to anonymous:", error.message);
                        await signInAnonymously(auth);
                    }
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    authReady = true;
                    updateAuthStateUI(user);
                });
            } else {
                updateAuthStateUI(null);
            }
        }

        // Add Logout Handler
        if (sidebarLogoutButton) {
            sidebarLogoutButton.addEventListener('click', async () => {
                if (auth && authReady) {
                    try {
                        await signOut(auth);
                        // UI update happens via onAuthStateChanged listener
                    } catch (error) {
                        console.error("Error signing out:", error.message);
                    }
                } else {
                    console.log("Logout simulation (Firebase not initialized or auth not ready).");
                    updateAuthStateUI(null); // Simulate logout
                }
            });
        }

        handleAuthInitialization();
    </script>
</body>
</html>

